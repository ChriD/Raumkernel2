# Makefile template for shared library

INCPATH = -I includes/

CC = g++-4.9
CXX = g++-4.9
CFLAGS = -std=c++11 -fPIC -Wall -Wno-unknown-pragmas -Wno-unused-parameter -Wextra -O2 -c -g -pthread $(INCPATH)
CXXFLAGS = -std=c++11 -fPIC -Wall -Wno-unknown-pragmas -Wno-unused-parameter -Wextra -O2 -c -g -pthread $(INCPATH)
LDFLAGS = -shared -pthread -static-libgcc -static-libstdc++

LIBSDEF =  libs/linux_x86/libohNetCore.a libs/linux_x86/libohNetDevices.a libs/linux_x86/libohNetProxies.a

RM = rm -f 
TARGET_LIB = libs/linux_x86/raumkernel.so

SRCS = $(wildcard *.cpp)
SRCS += $(wildcard device/*.cpp)
SRCS += $(wildcard device/eventParser/*.cpp)
SRCS += $(wildcard device/proxies/*.cpp)
SRCS += $(wildcard httpclient/*.cpp)
SRCS += $(wildcard logger/*.cpp)
SRCS += $(wildcard manager/*.cpp)
SRCS += $(wildcard media/*.cpp)
SRCS += $(wildcard media/item/*.cpp)
SRCS += $(wildcard tools/*.cpp)
SRCS += $(wildcard xml/pugixml/*.cpp)

OBJS = $(SRCS:.cpp=.o)

#.PHONY: test
#test: $(SRCS)
#	$(CC) -o $(TARGET_LIB) $(SRCS) -shared -fPIC -Wall -Wextra -O2


.PHONY: all
all: ${TARGET_LIB}

$(TARGET_LIB): $(OBJS)
	$(CC) ${LDFLAGS} -o $@ $^ $(LIBSDEF)
 
$(SRCS:.cpp=.d):%.d:%.cpp
	$(CC) $(CFLAGS) -MM $< >$@

include $(SRCS:.cpp=.d)


.PHONY: clean
clean:
	-${RM} ${TARGET_LIB} ${OBJS} $(SRCS:.cpp=.d) 
